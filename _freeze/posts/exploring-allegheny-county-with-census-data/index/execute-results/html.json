{
  "hash": "4e1d1300a2fb20ca178526f489b78a03",
  "result": {
    "engine": "knitr",
    "markdown": "---\n# Documentation: https://sourcethemes.com/academic/docs/managing-content/\n\ntitle: \"Exploring Allegheny County With Census Data\"\nsubtitle: \"\"\nsummary: \"\"\nauthors: [Conor Tompkins]\ntags: [R, Census, Allegheny County]\ncategories: [R, Census, Allegheny County]\ndate: 2018-08-06\nlastmod: 2020-09-26\nfeatured: false\ndraft: false\nexecute: \n  echo: true\n  warning: false\n  message: false\n---\n\n\n\nThis post explores Allegheny County and Pennsylvania through census data. I use the tidycensus and sf packages to collect data from the census API and draw maps with the data.\n\n## Setup\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(tidyverse)\nlibrary(tidycensus)\nlibrary(tigris)\nlibrary(sf)\nlibrary(broom)\nlibrary(ggfortify)\nlibrary(viridis)\nlibrary(scales)\nlibrary(janitor)\n\noptions(tigris_use_cache = TRUE)\n\ntheme_set(theme_bw())\n\ncensus_vars <- load_variables(2010, \"sf1\", cache = TRUE)\n```\n:::\n\n\n\n## Collect data\n\ntidycensus provides a wrapper for the U.S. Census API. You can request a wide variety of data, from economic measures to information about demography. The API also includes data about geographic regions.\n\nThis code creates a dataframe of some of the variables available through the census API.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nvars <- load_variables(2016, \"acs5\", cache = TRUE)\n\nvars\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n# A tibble: 22,816 × 4\n   name        label                                  concept          geography\n   <chr>       <chr>                                  <chr>            <chr>    \n 1 B00001_001  Estimate!!Total                        UNWEIGHTED SAMP… block gr…\n 2 B00002_001  Estimate!!Total                        UNWEIGHTED SAMP… block gr…\n 3 B01001A_001 Estimate!!Total                        SEX BY AGE (WHI… tract    \n 4 B01001A_002 Estimate!!Total!!Male                  SEX BY AGE (WHI… tract    \n 5 B01001A_003 Estimate!!Total!!Male!!Under 5 years   SEX BY AGE (WHI… tract    \n 6 B01001A_004 Estimate!!Total!!Male!!5 to 9 years    SEX BY AGE (WHI… tract    \n 7 B01001A_005 Estimate!!Total!!Male!!10 to 14 years  SEX BY AGE (WHI… tract    \n 8 B01001A_006 Estimate!!Total!!Male!!15 to 17 years  SEX BY AGE (WHI… tract    \n 9 B01001A_007 Estimate!!Total!!Male!!18 and 19 years SEX BY AGE (WHI… tract    \n10 B01001A_008 Estimate!!Total!!Male!!20 to 24 years  SEX BY AGE (WHI… tract    \n# ℹ 22,806 more rows\n```\n\n\n:::\n:::\n\n\n\nThis code requests information about the median income of census tracts in Allegheny County. The \"geography\" argument sets the level of geographic granularity.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nallegheny <- get_acs(state = \"PA\", \n                     county = \"Allegheny County\", \n                     geography = \"tract\", \n                     variables = c(median_income = \"B19013_001\"),\n                     year = 2018,\n                     geometry = TRUE,\n                     cb = FALSE)\n\nhead(allegheny)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\nSimple feature collection with 6 features and 5 fields\nGeometry type: MULTIPOLYGON\nDimension:     XY\nBounding box:  xmin: -80.16148 ymin: 40.41478 xmax: -79.88377 ymax: 40.57546\nGeodetic CRS:  NAD83\n        GEOID                                              NAME      variable\n1 42003563200 Census Tract 5632, Allegheny County, Pennsylvania median_income\n2 42003980000 Census Tract 9800, Allegheny County, Pennsylvania median_income\n3 42003564100 Census Tract 5641, Allegheny County, Pennsylvania median_income\n4 42003461000 Census Tract 4610, Allegheny County, Pennsylvania median_income\n5 42003437000 Census Tract 4370, Allegheny County, Pennsylvania median_income\n6 42003981800 Census Tract 9818, Allegheny County, Pennsylvania median_income\n  estimate   moe                       geometry\n1    29750  8141 MULTIPOLYGON (((-80.00469 4...\n2       NA    NA MULTIPOLYGON (((-79.90168 4...\n3   145179 11268 MULTIPOLYGON (((-80.09943 4...\n4    39063  6923 MULTIPOLYGON (((-80.16148 4...\n5   106250 11871 MULTIPOLYGON (((-80.12246 4...\n6       NA    NA MULTIPOLYGON (((-79.90822 4...\n```\n\n\n:::\n:::\n\n\n\nThis code maps the data onto the census tracts.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nallegheny %>%\n  ggplot(aes(fill = estimate, color = estimate)) + \n  geom_sf() + \n  scale_fill_viridis(\"Median household income\", option = \"magma\", labels = comma) +\n  scale_color_viridis(\"Median household income\", option = \"magma\", labels = comma) +\n  labs(title = \"Allegheny County\",\n       subtitle = \"American Community Survey\") +\n  theme(axis.text = element_blank())\n```\n\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-4-1.png){width=672}\n:::\n:::\n\n\n\nThis code requests information about the ethnicities within each census tract. Then, it calculates the percentage of the entire population of a tract that each ethnicity makes up.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nracevars <- c(White = \"P005003\", \n              Black = \"P005004\", \n              Asian = \"P005006\", \n              Hispanic = \"P004003\")\n\nget_decennial(geography = \"tract\", \n              variables = racevars,\n              state = \"PA\", \n              county = \"Allegheny\", \n              geometry = TRUE,\n              summary_var = \"P001001\",\n              year = 2010,) %>% \n  mutate(value = value / summary_value,\n         variable = str_c(\"percent_\", tolower(variable))) -> allegheny_race\n\nhead(allegheny_race)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\nSimple feature collection with 6 features and 5 fields\nGeometry type: MULTIPOLYGON\nDimension:     XY\nBounding box:  xmin: -80.12431 ymin: 40.54225 xmax: -79.99058 ymax: 40.61431\nGeodetic CRS:  NAD83\n# A tibble: 6 × 6\n  GEOID       NAME      variable   value summary_value                  geometry\n  <chr>       <chr>     <chr>      <dbl>         <dbl>        <MULTIPOLYGON [°]>\n1 42003412002 Census T… percent… 0.916            4865 (((-80.07936 40.58043, -…\n2 42003412002 Census T… percent… 0.00843          4865 (((-80.07936 40.58043, -…\n3 42003412002 Census T… percent… 0.0580           4865 (((-80.07936 40.58043, -…\n4 42003412002 Census T… percent… 0.0103           4865 (((-80.07936 40.58043, -…\n5 42003413100 Census T… percent… 0.878            6609 (((-80.06788 40.60846, -…\n6 42003413100 Census T… percent… 0.0172           6609 (((-80.06788 40.60846, -…\n```\n\n\n:::\n:::\n\n\n\nThis code maps that data. The facet_wrap function creates a map for each ethnicity.\n\n\n::: {.cell}\n\n```{.r .cell-code}\n#allegheny_race <- st_erase(allegheny_race, allegheny_water)\n\nallegheny_race %>%\n  ggplot(aes(fill = value, color = value)) +\n  facet_wrap(~variable) +\n  geom_sf() +\n  scale_fill_viridis(\"Percent\", option = \"magma\", labels = percent) +\n  scale_color_viridis(\"Percent\", option = \"magma\", labels = percent) +\n  theme(axis.text = element_blank())\n```\n\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-6-1.png){width=672}\n:::\n:::\n\n\n\nYou can also request data for an entire state. This code requests the median income for each census tract in Pennsylvania.\n\n\n::: {.cell}\n\n```{.r .cell-code}\npa <- get_acs(state = \"PA\",\n              geography = \"tract\", \n              variables = c(median_income = \"B19013_001\"), \n              year = 2018,\n              geometry = TRUE)\n\nhead(pa)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\nSimple feature collection with 6 features and 5 fields\nGeometry type: MULTIPOLYGON\nDimension:     XY\nBounding box:  xmin: -80.14905 ymin: 40.32178 xmax: -75.6175 ymax: 41.07083\nGeodetic CRS:  NAD83\n        GEOID                                           NAME      variable\n1 42019910500 Census Tract 9105, Butler County, Pennsylvania median_income\n2 42019912200 Census Tract 9122, Butler County, Pennsylvania median_income\n3 42021000100   Census Tract 1, Cambria County, Pennsylvania median_income\n4 42021012600 Census Tract 126, Cambria County, Pennsylvania median_income\n5 42025020700  Census Tract 207, Carbon County, Pennsylvania median_income\n6 42027010800  Census Tract 108, Centre County, Pennsylvania median_income\n  estimate   moe                       geometry\n1       NA    NA MULTIPOLYGON (((-80.04897 4...\n2    93446 11356 MULTIPOLYGON (((-80.14905 4...\n3    12907  1274 MULTIPOLYGON (((-78.92583 4...\n4    47143  9880 MULTIPOLYGON (((-78.73584 4...\n5    57939  4427 MULTIPOLYGON (((-75.71378 4...\n6    53569  4123 MULTIPOLYGON (((-77.55509 4...\n```\n\n\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\npa %>%\n  ggplot(aes(fill = estimate, color = estimate)) + \n  geom_sf() + \n  scale_fill_viridis(\"Estimated median income\", option = \"magma\", label = comma) + \n  scale_color_viridis(\"Estimated median income\", option = \"magma\", label = comma) +\n  theme(axis.text = element_blank())\n```\n\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-8-1.png){width=672}\n:::\n:::\n\n\n\nThis code requests ethnicity data for each tract in Pennsylvania.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nracevars <- c(White = \"P005003\", \n              Black = \"P005004\", \n              Asian = \"P005006\", \n              Hispanic = \"P004003\")\n\nget_decennial(geography = \"tract\", \n              variables = racevars,\n              state = \"PA\",\n              year = 2010,\n              geometry = TRUE,\n              summary_var = \"P001001\") %>% \n  mutate(value = value / summary_value,\n         variable = str_c(\"percent_\", tolower(variable))) -> pa_race\n\nhead(pa_race)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\nSimple feature collection with 6 features and 5 fields\nGeometry type: MULTIPOLYGON\nDimension:     XY\nBounding box:  xmin: -80.12431 ymin: 40.54225 xmax: -79.99058 ymax: 40.61431\nGeodetic CRS:  NAD83\n# A tibble: 6 × 6\n  GEOID       NAME      variable   value summary_value                  geometry\n  <chr>       <chr>     <chr>      <dbl>         <dbl>        <MULTIPOLYGON [°]>\n1 42003412002 Census T… percent… 0.916            4865 (((-80.07936 40.58043, -…\n2 42003412002 Census T… percent… 0.00843          4865 (((-80.07936 40.58043, -…\n3 42003412002 Census T… percent… 0.0580           4865 (((-80.07936 40.58043, -…\n4 42003412002 Census T… percent… 0.0103           4865 (((-80.07936 40.58043, -…\n5 42003413100 Census T… percent… 0.878            6609 (((-80.06788 40.60846, -…\n6 42003413100 Census T… percent… 0.0172           6609 (((-80.06788 40.60846, -…\n```\n\n\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\npa_race %>%\n  ggplot(aes(fill = value, color = value)) +\n  facet_wrap(~variable) +\n  geom_sf() +\n  labs(title = \"Major ethncities in Pennsylvania\",\n       subtitle = \"Census data\") +\n  scale_fill_viridis(\"Percent\", option = \"magma\", label = percent) +\n  scale_color_viridis(\"Percent\", option = \"magma\", label = percent) +\n  theme(axis.text = element_blank())\n```\n\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-10-1.png){width=672}\n:::\n:::\n\n\n\nResources used:\n\n* http://strimas.com/r/tidy-sf/\n* https://walkerke.github.io/tidycensus/articles/spatial-data.html\n* https://walkerke.github.io/tidycensus/index.html\n* https://walkerke.github.io/2017/06/comparing-metros/",
    "supporting": [
      "index_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}