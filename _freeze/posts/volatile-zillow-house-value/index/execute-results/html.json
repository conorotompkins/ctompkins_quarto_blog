{
  "hash": "c744257651cd4f91cd67641335a490c0",
  "result": {
    "markdown": "---\ntitle: \"Graphing volatile home values in U.S. metro areas\"\nauthors: \"Conor Tompkins\"\ntags: [Housing, Zillow]\ncategories: [Housing, Zillow]\ndate: 2020-10-21\nlastmod: 2020-10-21T08:47:12-04:00\nfeatured: false\ndraft: false\nexecute: \n  warning: false\n# Featured image\n# To use, add an image named `featured.jpg/png` to your page's folder.\n# Focal points: Smart, Center, TopLeft, Top, TopRight, Left, Right, BottomLeft, Bottom, BottomRight.\nimage: featured.png\nfocal_point: \"\"\npreview_only: false\n\n# Projects (optional).\n#   Associate this post with one or more of your projects.\n#   Simply enter your project's folder or file name without extension.\n#   E.g. `projects = [\"internal-project\"]` references `content/project/deep-learning/index.md`.\n#   Otherwise, set `projects = []`.\nprojects: []\n---\n\nZillow publishes a variety of cool data that I haven't explored much yet. The first dataset that caught my eye was the Zillow Home Value Index (ZHVI). Zillow describes it as the \"smoothed, seasonally adjusted measure of the typical home value and market changes across a given region and housing type\". In this post I will make a quick `gganimate` plot of the ZHVI of various metro areas in the U.S.\n\n**The code for this post was re-ran in 2024. The data was filtered to match the date of the original post.**\n\n\n\n\n\nThe first thing I noticed about the data is that it is *aggressively* wide. There is a column for each year-month in the dataset. 293 columns is a lot to work with.\n\n::: {.cell}\n\n```{.r .cell-code}\n#download housing data from https://www.zillow.com/research/data/\nzillow_house_value <- read_csv(\"post_data/Metro_zhvi_uc_sfrcondo_tier_0.33_0.67_sm_sa_month.csv\")\n\ndim(zillow_house_value)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n[1] 895 293\n```\n:::\n:::\n\nTo make the data more tidy, I use a regex to identify the columns that have a date in the name and pivot those longer. Now each row represents the ZHVI for a given region area on a given year-month.\n\n::: {.cell}\n\n```{.r .cell-code}\nzillow_house_value <- zillow_house_value %>% \n  pivot_longer(cols = matches(\"\\\\d{4}-\\\\d{2}-\\\\d{2}\"),\n               names_to = \"date\", values_to = \"zhvi\") %>% \n  clean_names() %>% \n  mutate(date = ymd(date),\n         region_name = str_squish(region_name))\n\nglimpse(zillow_house_value)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\nRows: 257,760\nColumns: 7\n$ region_id   <dbl> 102001, 102001, 102001, 102001, 102001, 102001, 102001, 10…\n$ size_rank   <dbl> 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0…\n$ region_name <chr> \"United States\", \"United States\", \"United States\", \"United…\n$ region_type <chr> \"country\", \"country\", \"country\", \"country\", \"country\", \"co…\n$ state_name  <chr> NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA…\n$ date        <date> 2000-01-31, 2000-02-29, 2000-03-31, 2000-04-30, 2000-05-3…\n$ zhvi        <dbl> 118707, 118916, 119175, 119730, 120370, 121055, 121781, 12…\n```\n:::\n:::\n\n\nOnce the data is tidy, it is easy to plot with `ggplot2`. In this graph, each line represents one metro area.\n\n::: {.cell}\n\n```{.r .cell-code}\nzillow_house_value %>% \n  ggplot(aes(date, zhvi, group = region_name)) +\n  geom_line(alpha = .1, size = .5)\n```\n\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-4-1.png){width=672}\n:::\n:::\n\n\nWhat struck me is that while most metro areas in the dataset start with ZHVI < $300,000, many increase to 3x that, with many wild swings along the way due to housing bubbles, economic crashes, and housing scarcity. I will rank the metro areas by volatility (standard deviation of ZHVI) and use `ggplot2` and `gganimate` to highlight the most volatile metro areas.\n\n::: {.cell}\n\n```{.r .cell-code}\n#find most volatile regions\ndf_top_regions <- zillow_house_value %>% \n  group_by(region_name) %>% \n  summarize(sd = sd(zhvi)) %>% \n  ungroup() %>% \n  arrange(desc(sd)) %>% \n  slice(1:25) %>% \n  mutate(region_name_rank = str_c(\"#\", row_number(), \" \", region_name, sep = \"\"))\n  \nregion_name_highlight_fct <- df_top_regions %>% \n  pull(region_name)\n\nregion_name_rank_fct <- df_top_regions %>% \n  pull(region_name_rank)\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\n#create highlight df\ndf_highlights <- zillow_house_value %>% \n  inner_join(df_top_regions) %>% \n  mutate(region_name_highlight = region_name,\n         region_name_highlight = factor(region_name_highlight, levels = region_name_highlight_fct),\n         region_name_rank = factor(region_name_rank, levels = region_name_rank_fct))\n\nhousing_animation <- zillow_house_value %>% \n  ggplot() +\n  geom_line(aes(date, zhvi, group = region_name), alpha = .1, size = .5) +\n  geom_line(data = df_highlights,\n            aes(date, zhvi),\n            color = \"red\", size = 1.5) +\n  scale_y_continuous(labels = scales::dollar_format()) +\n  transition_manual(region_name_rank) +\n  labs(title = \"Top 25 most volatile housing markets 1996-2020\",\n       subtitle = \"Region: {current_frame}\",\n       x = NULL,\n       y = \"Zillow Housing Value Index\") +\n  theme(plot.subtitle = element_text(size = 15),\n        axis.title.y = element_text(size = 15))\n\nhousing_animation <- animate(housing_animation, duration = 10, fps = 40)\n\nhousing_animation\n```\n\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-6-1.gif)\n:::\n:::\n\n\n![](images/housing_animation-01.gif)",
    "supporting": [
      "index_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}