{
  "hash": "62df87942cd1b31505117e4d08aa5fff",
  "result": {
    "engine": "knitr",
    "markdown": "---\n# Documentation: https://sourcethemes.com/academic/docs/managing-content/\n\ntitle: \"Allegheny County Overdose Data\"\nsubtitle: \"\"\nsummary: \"\"\nauthors: [Conor Tompkins]\ntags: [R, Allegheny County, Overdoses]\ncategories: [R, Allegheny County, Overdoses]\ndate: 2018-02-16\nlastmod: 2018-02-16\nfeatured: false\ndraft: false\nexecute: \n  echo: true\n  warning: false\n  message: false\n---\n\n\nOpiate addiction and overdose have become a major problem in American society. [The life expectancy in the U.S. has decreased for the past 2 years, and deaths from drug overdoses rose 21% from 2016 to 2017.](https://www.washingtonpost.com/national/health-science/fueled-by-drug-crisis-us-life-expectancy-declines-for-a-second-straight-year/2017/12/20/2e3f8dea-e596-11e7-ab50-621fe0588340_story.html?utm_term=.373d79de65f5)\n\nCommunities have been [flooded with prescription painkillers with deadly effects.](https://www.wvgazettemail.com/news/health/drug-firms-shipped-m-pain-pills-to-wv-town-with/article_ef04190c-1763-5a0c-a77a-7da0ff06455b.html)\n\nPennsylvania and the Pittsburgh area have also suffered from drug overdoses. [38 out of every 100,000 Pennsylvanians died from a drug overdose in 2017](http://www.post-gazette.com/news/health/2017/12/21/CDC-releases-opioid-overdoses-deaths-data-figures-surge-fentanyl/stories/201712210100)\n\nThe [Western Pennsylvania Regional Data Center has published data on accidental fatal overdoses in Allegheny County](https://data.wprdc.org/dataset/allegheny-county-fatal-accidental-overdoses). The data spans from 2008 to present day, with a few months of delay on the most recent data due to the time required to collect and process the data.\n\nIn this post, I will use R to perform an exploratory data analysis on this data. I hope to find interesting trends in the data, and identify areas for further study. As always, the code and data used in this post are available here and on my [GitHub repository for this post.](https://github.com/conorotompkins/allegheny_overdoses)\n\nThe first step is to load the libraries we will use, and to set the theme for all the plots.\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(tidyverse)\nlibrary(lubridate)\nlibrary(scales)\nlibrary(viridis)\nlibrary(ggrepel)\nlibrary(knitr)\nlibrary(kableExtra)\n\n#use a customized version of theme_bw()\ntheme_set(theme_bw(base_size = 18))\n```\n:::\n\n\n\nThen, load the data that the WPRDC published. I've already done some preprocessing of the data to get it into shape. You can find that script [here](https://github.com/conorotompkins/allegheny_overdoses/blob/master/scripts/load_data.R).\n\n\n::: {.cell}\n\n```{.r .cell-code}\ndf <- read_csv(\"https://raw.githubusercontent.com/conorotompkins/allegheny_overdoses/master/data/overdose_df.csv\")\n```\n:::\n\n\n\nThis code changes the way R treats some of the data, which makes it more useful for plotting. It also filters out data that was entered after September 1, 2017. This is because the data after that date is not complete.\n\n\n::: {.cell}\n\n```{.r .cell-code}\ndf %>% \n  mutate(year = as.factor(year),\n         incident_zip = as.character(incident_zip),\n         month = month(date, label = TRUE)) %>% \n    filter(date <= \"2017-09-01\") -> df\n```\n:::\n\n\n\nLet's look at what the data looks like. Each row represents an individual overdose.\n\n\n::: {.cell}\n\n```{.r .cell-code}\ndf %>% \n  select(-c(year, yday, month, mday, wday, starts_with(\"combined\"))) %>% \n  head() %>% \n  kable(\"html\") %>% \n  kable_styling()\n```\n\n::: {.cell-output-display}\n`````{=html}\n<table class=\"table\" style=\"margin-left: auto; margin-right: auto;\">\n <thead>\n  <tr>\n   <th style=\"text-align:right;\"> id </th>\n   <th style=\"text-align:left;\"> date </th>\n   <th style=\"text-align:left;\"> death_time </th>\n   <th style=\"text-align:left;\"> manner_of_death </th>\n   <th style=\"text-align:right;\"> age </th>\n   <th style=\"text-align:left;\"> sex </th>\n   <th style=\"text-align:left;\"> race </th>\n   <th style=\"text-align:left;\"> case_dispo </th>\n   <th style=\"text-align:left;\"> incident_zip </th>\n   <th style=\"text-align:right;\"> decedent_zip </th>\n   <th style=\"text-align:left;\"> od_factors </th>\n  </tr>\n </thead>\n<tbody>\n  <tr>\n   <td style=\"text-align:right;\"> 1 </td>\n   <td style=\"text-align:left;\"> 2008-01-03 </td>\n   <td style=\"text-align:left;\"> 06:20:00 </td>\n   <td style=\"text-align:left;\"> ACCIDENT </td>\n   <td style=\"text-align:right;\"> 44 </td>\n   <td style=\"text-align:left;\"> Male </td>\n   <td style=\"text-align:left;\"> Black </td>\n   <td style=\"text-align:left;\"> MO </td>\n   <td style=\"text-align:left;\"> 15212 </td>\n   <td style=\"text-align:right;\"> 15212 </td>\n   <td style=\"text-align:left;\"> Alcohol, Codeine, Morphine </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:right;\"> 2 </td>\n   <td style=\"text-align:left;\"> 2008-01-03 </td>\n   <td style=\"text-align:left;\"> 10:19:00 </td>\n   <td style=\"text-align:left;\"> ACCIDENT </td>\n   <td style=\"text-align:right;\"> 42 </td>\n   <td style=\"text-align:left;\"> Male </td>\n   <td style=\"text-align:left;\"> White </td>\n   <td style=\"text-align:left;\"> MO </td>\n   <td style=\"text-align:left;\"> NA </td>\n   <td style=\"text-align:right;\"> 15206 </td>\n   <td style=\"text-align:left;\"> Mephobarbital, Morphine, Phenobarbital </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:right;\"> 3 </td>\n   <td style=\"text-align:left;\"> 2008-01-04 </td>\n   <td style=\"text-align:left;\"> 09:43:00 </td>\n   <td style=\"text-align:left;\"> ACCIDENT </td>\n   <td style=\"text-align:right;\"> 58 </td>\n   <td style=\"text-align:left;\"> Male </td>\n   <td style=\"text-align:left;\"> White </td>\n   <td style=\"text-align:left;\"> MO </td>\n   <td style=\"text-align:left;\"> 15132 </td>\n   <td style=\"text-align:right;\"> 15132 </td>\n   <td style=\"text-align:left;\"> Alcohol, Methadone, Nordiazepam </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:right;\"> 4 </td>\n   <td style=\"text-align:left;\"> 2008-01-04 </td>\n   <td style=\"text-align:left;\"> 23:15:00 </td>\n   <td style=\"text-align:left;\"> ACCIDENT </td>\n   <td style=\"text-align:right;\"> 39 </td>\n   <td style=\"text-align:left;\"> Male </td>\n   <td style=\"text-align:left;\"> White </td>\n   <td style=\"text-align:left;\"> MO </td>\n   <td style=\"text-align:left;\"> 15204 </td>\n   <td style=\"text-align:right;\"> 15204 </td>\n   <td style=\"text-align:left;\"> Alprazolam, Methadone, Nordiazepam </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:right;\"> 5 </td>\n   <td style=\"text-align:left;\"> 2008-01-05 </td>\n   <td style=\"text-align:left;\"> 07:45:00 </td>\n   <td style=\"text-align:left;\"> ACCIDENT </td>\n   <td style=\"text-align:right;\"> 42 </td>\n   <td style=\"text-align:left;\"> Male </td>\n   <td style=\"text-align:left;\"> White </td>\n   <td style=\"text-align:left;\"> MO </td>\n   <td style=\"text-align:left;\"> 15239 </td>\n   <td style=\"text-align:right;\"> 15239 </td>\n   <td style=\"text-align:left;\"> Alcohol, Morphine </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:right;\"> 6 </td>\n   <td style=\"text-align:left;\"> 2008-01-05 </td>\n   <td style=\"text-align:left;\"> 10:50:00 </td>\n   <td style=\"text-align:left;\"> Accidents </td>\n   <td style=\"text-align:right;\"> 34 </td>\n   <td style=\"text-align:left;\"> Male </td>\n   <td style=\"text-align:left;\"> White </td>\n   <td style=\"text-align:left;\"> MO </td>\n   <td style=\"text-align:left;\"> 15235 </td>\n   <td style=\"text-align:right;\"> 15235 </td>\n   <td style=\"text-align:left;\"> Diphenhydramine, Morphine, Paroxetine, Trazodone </td>\n  </tr>\n</tbody>\n</table>\n\n`````\n:::\n:::\n\n\n\nThis chart shows the cumulative sum of all fatal overdoses in the timeframe of the dataset. This plot shows a visible uptick in the number of overdoses starting in 2015.\n\n\n::: {.cell}\n\n```{.r .cell-code}\ndf %>% \n  count(date) %>% \n  mutate(n_cumsum = cumsum(n)) %>% \n  ggplot(aes(date, n_cumsum)) +\n  geom_hline(yintercept = 0) +\n  geom_line(size = 2) +\n  scale_y_continuous(label=comma) +\n  labs(title = \"Fatal overdoses in Allegheny County\",\n       y = \"Cumulative sum of fatal overdoses\",\n       x = \"\",\n       subtitle = \"Data from the WPRDC\",\n       caption = \"Conor Tompkins @conor_tompkins\")\n```\n\n::: {.cell-output-display}\n![](index_files/figure-html/cumulative sum-1.png){width=1152}\n:::\n:::\n\n\n\nWe can explore this data more granularly by looking at each year individually. The overall trend for the years 2008-2014 appear to be largely the same. As we saw in the previous graph, the number of fatal overdoses began to increase in 2015, and the situation worsened in 2016. 2017 was clearly on pace to be the worst year on record.\n\n\n::: {.cell}\n\n```{.r .cell-code}\ndf %>% \n  group_by(year, yday) %>% \n  summarize(n = n()) %>% \n  mutate(n_cumsum = cumsum(n)) -> df_year_cumsum\n\ndf %>% \n  group_by(year) %>% \n  summarize(last_yday = last(yday),\n            total = n()) -> df_year_tag\n\nggplot(data = df_year_cumsum, aes(x = yday, y = n_cumsum, color = year)) +\n  geom_line(size = 2) +\n  geom_label_repel(data = df_year_tag, aes(x = last_yday, y = total, label = year, color = year, group = year)) +\n  geom_point(data = df_year_tag, aes(x = last_yday, y = total, color = year, group = year), size = 3) +\n  scale_size_continuous(guide = FALSE) +\n  scale_color_discrete(guide = FALSE) +\n  labs(title = \"Fatal overdoses by year\",\n       x = \"Day of the year\",\n       y = \"Cumulative sum of fatal overdoses\",\n       subtitle = \"Data from the WPRDC\",\n       caption = \"Conor Tompkins @conor_tompkins\")\n```\n\n::: {.cell-output-display}\n![](index_files/figure-html/fatal_ODs_by_year_cumulative-1.png){width=1152}\n:::\n:::\n\n\n\nThis plot shows a smoothed representation of the number of fatal overdoses per day for each year. 2016 and 2017 stand out here. Overdoses in 2016 escalated around June. As we saw previously, 2017 was worse than 2016.\n\n\n::: {.cell}\n\n```{.r .cell-code}\ndf %>% \n  count(year, yday) -> df_year\n\ndf %>% \n  count(year, yday) %>% \n  group_by(year) %>% \n  mutate(smooth = predict(loess(n ~ yday))) %>% \n  summarize(last_yday = last(yday),\n            last_smooth = last(smooth),\n            tag = unique(year)) -> df_year_label\n\nggplot(data = df_year, aes(x = yday, y = n, color = year)) +\n  geom_smooth(se = FALSE) +\n  geom_label_repel(data = df_year_label, aes(x = last_yday, y = last_smooth, label = year)) +\n  geom_point(data = df_year_label, aes(x = last_yday, y = last_smooth), size = 3) +\n  scale_color_discrete(guide = FALSE) +\n  labs(title = \"Fatal overdoses by year\",\n       x = \"Day of the year\",\n       y = \"Number of overdoses\",\n       subtitle = \"Data from the WPRDC\",\n       caption = \"Conor Tompkins @conor_tompkins\")\n```\n\n::: {.cell-output-display}\n![](index_files/figure-html/year_plot-1.png){width=1152}\n:::\n:::\n\n\n\nThis heatmap shows the number of fatal overdoses by day of the month, month, and year. This plot shows spikes in deaths, especially in 2016 and 2017. [Some media report that this phenomenon could be explained by fentanyl, a particularly potent synthetic opiate.](https://www.yorkdispatch.com/story/news/2017/12/05/heroin-overdoses-spike-york-county/916485001/) For example, a heroin user could get a supply of heroin laced with fentanyl, and underestimate the strength of the dose. \n\n\n::: {.cell}\n\n```{.r .cell-code}\n#create df of full calendar\ndf_dates <- tibble(date = seq(first(df$date), last(df$date), by = \"day\"))\n\n#create tile df\ndf %>% \n  mutate(n = 1) %>% \n  right_join(df_dates) %>% \n  mutate(year = year(date),\n         month = month(date, label = TRUE),\n         mday = mday(date)) %>% \n  group_by(year, month, mday) %>% \n  summarize(n = sum(n)) %>% \n  replace_na(list(n = 0)) -> df_tile\n\ndf_tile %>% \n  ggplot(aes(mday, month, fill = n)) +\n  geom_tile() +\n  facet_wrap(~year, ncol = 2) +\n  scale_fill_viridis(\"Number of fatal overdoses\") +\n  coord_equal() +\n  scale_x_continuous(expand = c(0,0)) +\n  scale_y_discrete(expand = c(0,0),\n                   limits = rev(levels(df$month))) +\n  labs(title = \"Fatal overdoses in Allegheny County\",\n       y = NULL,\n       x = \"Day of the month\",\n       subtitle = \"Data from the WPRDC\",\n       caption = \"Conor Tompkins @conor_tompkins\") +\n  theme(panel.grid = element_blank())\n```\n\n::: {.cell-output-display}\n![](index_files/figure-html/tile_graph-1.png){width=1152}\n:::\n:::\n\n\n\nThe WPRDC dataset identifies the zip code that the overdose occurred in, which allows a broad geographic analysis of which communities are affected. The Mt. Oliver/Knoxville/Carrick area (15210) is most affected, followed by the North Side/Brighton Heights/Spring Hill (15212) and McKees Rocks/Robinson (15136) areas.\n\n\n::: {.cell}\n\n```{.r .cell-code}\n#fatal overdoses by zip code\ntop_zips <- df %>% \n  count(incident_zip, sort = TRUE) %>% \n  top_n(5) %>% \n  select(incident_zip) %>% \n  unlist()\n\ndf %>% \n  count(incident_zip, sort = TRUE) %>% \n  top_n(5) %>% \n  rename(\"fatal_overdoses\" = n,\n         \"incident_zip_code\" = incident_zip) %>% \n  kable(\"html\") %>% \n  kable_styling()\n```\n\n::: {.cell-output-display}\n`````{=html}\n<table class=\"table\" style=\"margin-left: auto; margin-right: auto;\">\n <thead>\n  <tr>\n   <th style=\"text-align:left;\"> incident_zip_code </th>\n   <th style=\"text-align:right;\"> fatal_overdoses </th>\n  </tr>\n </thead>\n<tbody>\n  <tr>\n   <td style=\"text-align:left;\"> 15210 </td>\n   <td style=\"text-align:right;\"> 177 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> 15212 </td>\n   <td style=\"text-align:right;\"> 160 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> 15136 </td>\n   <td style=\"text-align:right;\"> 106 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> 15216 </td>\n   <td style=\"text-align:right;\"> 103 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> 15132 </td>\n   <td style=\"text-align:right;\"> 90 </td>\n  </tr>\n</tbody>\n</table>\n\n`````\n:::\n:::\n\n\n\nA cumulative view of the data by zip code show that 15210 and 15212 are in a different category compared to the other areas of Allegheny County.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nzips_df <- df %>% \n  arrange(incident_zip, date) %>% \n  count(incident_zip, date) %>% \n  group_by(incident_zip) %>% \n  mutate(n_cumsum = cumsum(n))\n\ntop_zips_df <- zips_df %>% \n  filter(incident_zip %in% top_zips)\n\ntop_zips_df_labels <- df %>% \n  filter(incident_zip %in% top_zips) %>% \n  group_by(incident_zip) %>% \n  summarize(last_date = last(date),\n            tag = unique(incident_zip),\n            total = n())\n\nggplot(zips_df, aes(x = date, y = n_cumsum, group = incident_zip)) +\n  geom_line(size = 1, alpha = .1) +\n  geom_line(data = top_zips_df, aes(x = date, y = n_cumsum, color = incident_zip), size = 2) +\n  geom_label_repel(data = top_zips_df_labels, aes(x = last_date, y = total, label = tag, color = incident_zip)) +\n  geom_point(data = top_zips_df_labels, aes(x = last_date, y = total, color = incident_zip), size = 3) +\n  scale_alpha_manual(values = c(.1, 1), guide = FALSE) +\n  scale_color_discrete(guide = FALSE) +\n  scale_y_continuous(expand = c(.01, .1)) +\n  labs(title = \"Fatal overdoses per zip code\",\n       x = NULL,\n       y = \"Cumulative sum of fatal overdoses\",\n       subtitle = \"Data from the WPRDC\",\n       caption = \"Conor Tompkins @conor_tompkins\")\n```\n\n::: {.cell-output-display}\n![](index_files/figure-html/fatal_ODs_by_zip-1.png){width=1152}\n:::\n:::\n\n\n\nA cumulative view of the number of overdoses by factor (drug) shows a striking trend. This table shows the top 10 drugs in terms of number of overdoses. It is important to note that most of these are not exclusive. An overdose victim can have multiple drugs in their system at the time of autopsy.\n\n\n::: {.cell}\n\n```{.r .cell-code}\ndf_factor_total <- tibble(factor = c(df$combined_od1,\n                 df$combined_od2,\n                 df$combined_od3,\n                 df$combined_od4,\n                 df$combined_od5,\n                 df$combined_od6,\n                 df$combined_od7))\n\ndf_factor_total <- df_factor_total %>% \n  filter(!is.na(factor)) %>% \n  count(factor, sort = TRUE)\n\ndf_factor_total %>% \n  rename(\"number_of_overdoses\" = n) %>% \n  top_n(10) %>% \n  kable(\"html\") %>% \n  kable_styling()\n```\n\n::: {.cell-output-display}\n`````{=html}\n<table class=\"table\" style=\"margin-left: auto; margin-right: auto;\">\n <thead>\n  <tr>\n   <th style=\"text-align:left;\"> factor </th>\n   <th style=\"text-align:right;\"> number_of_overdoses </th>\n  </tr>\n </thead>\n<tbody>\n  <tr>\n   <td style=\"text-align:left;\"> Heroin </td>\n   <td style=\"text-align:right;\"> 1449 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> Cocaine </td>\n   <td style=\"text-align:right;\"> 1071 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> Fentanyl </td>\n   <td style=\"text-align:right;\"> 1017 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> Alcohol </td>\n   <td style=\"text-align:right;\"> 807 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> Alprazolam </td>\n   <td style=\"text-align:right;\"> 497 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> Oxycodone </td>\n   <td style=\"text-align:right;\"> 375 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> Morphine </td>\n   <td style=\"text-align:right;\"> 304 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> Methadone </td>\n   <td style=\"text-align:right;\"> 282 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> Hydrocodone </td>\n   <td style=\"text-align:right;\"> 196 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> Diazepam </td>\n   <td style=\"text-align:right;\"> 190 </td>\n  </tr>\n</tbody>\n</table>\n\n`````\n:::\n:::\n\n\n\nCocaine was the most common drug in the system of overdose victims up until 2012, but it was passed by heroin in 2013. The number of overdoses involving fentanyl exploded in 2015.\n\n\n::: {.cell}\n\n```{.r .cell-code}\ndf %>% \n  mutate(od_heroin = str_detect(od_factors, \"Heroin\"),\n         od_cocaine = str_detect(od_factors, \"Cocaine\"),\n         od_fentanyl = str_detect(od_factors, \"Fentanyl\"),\n         od_alcohol = str_detect(od_factors, \"Alcohol\"),\n         od_alprazolam = str_detect(od_factors, \"Alprazolam\"),\n         od_oxycodone = str_detect(od_factors, \"Oxycodone\"),\n         od_morphine = str_detect(od_factors, \"Morphine\"),\n         od_methadone = str_detect(od_factors, \"Methadone\"),\n         od_hydrocodone = str_detect(od_factors, \"Hydrocodone\"),\n         od_diazepam = str_detect(od_factors, \"Diazepam\")) -> df_factors\n\n\ndf_factors %>% \n  gather(od_factor, od_flag, starts_with(\"od_\")) %>% \n  #gather(od_factor, od_flag, c(od_heroin, od_cocaine, od_fentanyl, od_alcohol)) %>% \n  filter(od_flag == TRUE) %>% \n  mutate(od_factor = str_to_title(str_replace(od_factor, \"od_\", \"\"))) -> df_factors_long\n\n#create od_factor df\ndf_factors_long %>% \n  group_by(od_factor, date) %>% \n  summarize(n = n()) %>% \n  group_by(od_factor) %>% \n  mutate(od_cumsum = cumsum(n)) -> df_factors_cumsum\n\n#create label df for od_factors\ndf_factors_long %>% \n  group_by(od_factor) %>% \n  summarize(last_date = last(date),\n            total = n()) -> df_factors_cumsum_label\n\n#plot cumulative od_factor\nggplot(data = df_factors_cumsum, aes(x = date, y = od_cumsum, color = od_factor)) +\n  geom_line(size = 1.5) +\n  geom_label_repel(data = df_factors_cumsum_label, aes(x = last_date, y = total, label = od_factor, group = od_factor)) +\n  geom_point(data = df_factors_cumsum_label, aes(x = last_date, y = total, group = od_factor, color = od_factor), size = 3) +\n  scale_color_discrete(guide = FALSE) +\n  scale_y_continuous(expand = c(.01, .1), label = comma) +\n  labs(title = \"Fatal overdoses by drug factor\",\n       y = \"Cumulative sum of fatal overdoses\",\n       x = \"\",\n       subtitle = \"Data from the WPRDC\",\n       caption = \"Conor Tompkins @conor_tompkins \\n Drug overdoses not exclusive\")\n```\n\n::: {.cell-output-display}\n![](index_files/figure-html/top_OD_factors_cumulative-1.png){width=1152}\n:::\n:::\n\n\n\nA view of the same data for the year 2017 show that fentanyl has by far been the most common drug linked to fatal overdoses.\n\n\n::: {.cell}\n\n```{.r .cell-code}\ndf_factors_long %>% \n  filter(date >= \"2017-01-01\") %>% \n  group_by(od_factor, date) %>% \n  summarize(n = n()) %>% \n  group_by(od_factor) %>% \n  mutate(od_cumsum = cumsum(n)) -> df_factors_cumsum_2017\n\ndf_factors_long %>% \n  filter(date >= \"2017-01-01\") %>% \n  group_by(od_factor) %>% \n  summarize(last_date = last(date),\n            total = n()) -> df_factors_cumsum_label_2017\n\ndf_factors_cumsum_2017 %>% \n  ggplot(aes(date, od_cumsum, color = od_factor)) +\n  geom_line(size = 2) +\n  geom_label_repel(data = df_factors_cumsum_label_2017, aes(x = last_date, y = total, label = od_factor, group = od_factor)) +\n  geom_point(data = df_factors_cumsum_label_2017, aes(x = last_date, y = total, group = od_factor, color = od_factor), size = 3) +\n  scale_color_discrete(guide = FALSE) +\n  scale_y_continuous(expand = c(.01, .1)) +\n  labs(title = \"Fatal overdoses by drug factor (2017)\",\n       y = \"Cumulative sum of fatal overdoses\",\n       x = \"\",\n       subtitle = \"Data from the WPRDC\",\n       caption = \"Conor Tompkins @conor_tompkins\")\n```\n\n::: {.cell-output-display}\n![](index_files/figure-html/top_OD_factors_cumulative_2017-1.png){width=1152}\n:::\n:::\n\n\n\nHeroin and fentanyl have proven to be a particularly deadly combination. We can explore the combination of these drugs. This plot shows the cumulative number of fatal overdoses involving heroin.\n\n\n::: {.cell}\n\n```{.r .cell-code}\ndf_factors %>% \n  select(date, od_heroin) %>% \n  filter(od_heroin) %>% \n  count(date) %>% \n  mutate(n_cumsum = cumsum(n),\n         tag = \"Heroin\") %>% \n  ggplot(aes(x = date, y = n_cumsum)) +\n  geom_line(size = 2) +\n  scale_y_continuous(label = comma) +\n  labs(title = \"Fatal overdoses involving heroin\",\n       x = \"\",\n       y = \"Cumulative sum of fatal overdoses\",\n       subtitle = \"Data from the WPRDC\",\n       caption = \"Conor Tompkins @conor_tompkins\")\n```\n\n::: {.cell-output-display}\n![](index_files/figure-html/heroin_cumulative-1.png){width=1152}\n:::\n:::\n\n\n\nThis plot shows the % of fatal heroin overdoses that also involve fentanyl. Again, we see that fentanyl arrived in Allegheny County in 2014, and quickly became closely linked to heroin. In late 2017, over 75% of heroin overdoses involved fentanyl.\n\n\n::: {.cell}\n\n```{.r .cell-code}\ndf_factors %>% \n  select(date, od_heroin, od_fentanyl) %>% \n  filter(od_heroin) %>% \n  group_by(date) %>% \n  summarize(percent_fentanyl = mean(od_fentanyl)) -> df_factors_heroin_fent \n\ndf_factors_heroin_fent %>% \n  ggplot(aes(date, percent_fentanyl)) +\n  geom_point(alpha = .1) +\n  geom_smooth() +\n  scale_y_continuous(labels = scales::percent) +\n  labs(title = \"Fatal heroin overdoses involving fentanyl\",\n       x = \"\",\n       y = \"% involving fentantyl\",\n       subtitle = \"Data from the WPRDC\",\n       caption = \"Conor Tompkins @conor_tompkins\")\n```\n\n::: {.cell-output-display}\n![](index_files/figure-html/heroin_and_fentanyl-1.png){width=1152}\n:::\n:::\n\n\n\n## Areas for further research\nGeographic analysis using the zip code data could expose more information about how communities are impacted by drug overdoses.\n\nDemographic analysis could be used to analyze how drug overdoses affect different parts of the population.\n\nThe combination of heroin and fentanyl can be explored further. It would also be worth exploring whether there is any link between fentanyl and cocaine. More generally, the correlation between the various drugs could be explored using network analysis.",
    "supporting": [
      "index_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {
      "include-in-header": [
        "<script src=\"../../site_libs/kePrint-0.0.1/kePrint.js\"></script>\n<link href=\"../../site_libs/lightable-0.0.1/lightable.css\" rel=\"stylesheet\" />\n"
      ]
    },
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}